<div class="profile-page">
    <div class="profile-header">
        <h1>My Profile</h1>
        <p class="subtitle">Manage your account information</p>
    </div>

    <div class="profile-container">
        <div class="profile-card">
            <!-- Left Section: Profile Picture -->
            <div class="profile-picture-section">
                <div class="avatar-wrapper">
                    <div class="avatar-large">
                        <img *ngIf="previewImage" [src]="previewImage" alt="Profile Picture">
                        <svg *ngIf="!previewImage" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <button *ngIf="isEditing" class="change-photo-btn" type="button" (click)="fileInput.click()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                        Change Photo
                    </button>
                    <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" style="display: none;">
                </div>
                <div class="user-info-summary">
                    <h2>{{ user.firstName }} {{ user.lastName }}</h2>
                    <p class="role-badge">{{ user.roleName }}</p>
                    <p class="division-text">{{ user.divisionName }}</p>
                </div>
            </div>

            <!-- Right Section: User Details Form -->
            <div class="profile-form-section">
                <div class="form-header">
                    <h3>Personal Information</h3>
                    <button *ngIf="!isEditing" class="edit-btn" (click)="toggleEdit()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        Edit Profile
                    </button>
                </div>

                <form class="profile-form" (ngSubmit)="saveProfile()">
                    <!-- Editable Fields -->
                    <div class="form-section">
                        <h4 class="section-title">Editable Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">First Name <span class="required">*</span></label>
                                <input 
                                    type="text" 
                                    id="firstName" 
                                    [(ngModel)]="user.firstName"
                                    name="firstName"
                                    [disabled]="!isEditing"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name <span class="required">*</span></label>
                                <input 
                                    type="text" 
                                    id="lastName" 
                                    [(ngModel)]="user.lastName"
                                    name="lastName"
                                    [disabled]="!isEditing"
                                    required>
                            </div>
                        </div>
                    </div>

                    <!-- Read-Only Fields -->
                    <div class="form-section">
                        <h4 class="section-title">Account Information <span class="info-text">(Contact admin to update)</span></h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input 
                                    type="text" 
                                    id="username" 
                                    [(ngModel)]="user.username"
                                    name="username"
                                    [disabled]="true">
                            </div>
                            <div class="form-group">
                                <label for="userID">User ID</label>
                                <input 
                                    type="text" 
                                    id="userID" 
                                    [value]="user.userID"
                                    name="userID"
                                    [disabled]="true">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="role">Role</label>
                                <input 
                                    type="text" 
                                    id="role" 
                                    [(ngModel)]="user.roleName"
                                    name="role"
                                    [disabled]="true">
                            </div>
                            <div class="form-group">
                                <label for="division">Division</label>
                                <input 
                                    type="text" 
                                    id="division" 
                                    [(ngModel)]="user.divisionName"
                                    name="division"
                                    [disabled]="true">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="createdAt">Account Created</label>
                                <input 
                                    type="text" 
                                    id="createdAt" 
                                    [value]="user.createdAt | date:'medium'"
                                    name="createdAt"
                                    [disabled]="true">
                            </div>
                            <div class="form-group">
                                <label for="lastLogin">Last Login</label>
                                <input 
                                    type="text" 
                                    id="lastLogin" 
                                    [value]="user.lastLogin | date:'medium'"
                                    name="lastLogin"
                                    [disabled]="true">
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions" *ngIf="isEditing">
                        <button type="button" class="cancel-btn" (click)="toggleEdit()" [disabled]="isSaving">
                            Cancel
                        </button>
                        <button type="submit" class="save-btn" [disabled]="isSaving">
                            <span *ngIf="!isSaving">Save Changes</span>
                            <span *ngIf="isSaving">Saving...</span>
                        </button>
                    </div>

                    <!-- Info Message -->
                    <div class="info-message">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <p>To update username, role, division, or other account settings, please contact your system administrator.</p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>